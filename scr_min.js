var video,entry,memcount_rep_int,singer_lookup=["reserved","看谷にぃあ","胡桃澤もも","ももにぃあ","逢魔きらら","きらにぃあ","ももきら","ぷちここ","つきみゆこ",9,10,11,12,13,14,15,"愛白ふりる",17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,"小悪熊ちゅい"],display_order=[-1,7,6,4,5,3,2,1,11,-1,-1,-1,-1,-1,-1,-1,10,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,9],member_display_order=[7,6,5,3,4,2,1],series_lookup={"マクロス":["マクロス","まくろす"],"ラブライブ":["ラブライブ","らぶらいぶ","LL","ll"],"アイマス":["アイマス","あいます","デレマス","でれます"],"ジブリ":["ジブリ","じぶり"],"物語シリーズ":["物語シリーズ","ものがたりしりーず","ものがたりシリーズ"],"まどマギ":["まどマギ","まどまぎ","まどか"],disney:["disney","ディズニー","でぃずにー","Disney"]},entry_idx={song_id:0,video:1,note:2,time:3,type:4},song_idx={name:0,artist:1,reading:2,attr:3,release:4,reference:5},video_idx={id:0,date:1},version="1.6.5",key_hash=["473c05c1ae8349a187d233a02c514ac73fe08ff4418429806a49f7b2fe4ba0b7a36ba95df1d58b8e84a602258af69194","3f01e53f1bcee58f6fb472b5d2cf8e00ce673b13599791d8d2d4ddcde3defbbb4e0ab7bc704538080d704d87d79d0410"],prevent_menu_popup=!1,current_page="home",key_valid=0,do_display_hidden=!0,do_select_input=!0,do_random_anyway=!1,do_show_random=!1,do_show_release=!1,do_longPress_copy=!0,entry_proc=[],processed_song_name=[""],theme=localStorage.getItem("theme");function process_data(){$("#loading_text").html("Processing data...");var e=new URLSearchParams(window.location.search);if(e.delete("key"),window.history.pushState(null,null,`${document.location.href.split("?")[0]}${e.size?`?${e}`:""}`),""!==getCookie("pcsl_settings_display")?(do_display_hidden="1"===getCookie("pcsl_settings_hidden"),do_select_input="1"===getCookie("pcsl_settings_clear"),do_random_anyway="1"===getCookie("pcsl_settings_random"),localStorage.setItem("pcsl_s_showHidden",getCookie("pcsl_settings_hidden")),localStorage.setItem("pcsl_s_selecInput",getCookie("pcsl_settings_clear")),localStorage.setItem("pcsl_s_showRandom","0"),localStorage.setItem("pcsl_s_ignoreRule",getCookie("pcsl_settings_random")),localStorage.setItem("pcsl_s_showReleas","0"),localStorage.setItem("pcsl_s_LPressCopy","1"),removeCookie("pcsl_settings_hidden"),removeCookie("pcsl_settings_clear"),removeCookie("pcsl_settings_random"),removeCookie("is_mobile"),removeCookie("pcsl_settings_display"),removeCookie("pcsl_settings_select"),removeCookie("pcsl_settings_share")):null===localStorage.getItem("pcsl_s_showHidden")?(localStorage.setItem("pcsl_s_showHidden","1"),localStorage.setItem("pcsl_s_selecInput","1"),localStorage.setItem("pcsl_s_showRandom","0"),localStorage.setItem("pcsl_s_ignoreRule","0"),localStorage.setItem("pcsl_s_showReleas","0"),localStorage.setItem("pcsl_s_LPressCopy","1")):(do_display_hidden="1"===localStorage.getItem("pcsl_s_showHidden"),do_select_input="1"===localStorage.getItem("pcsl_s_selecInput"),do_show_random="1"===localStorage.getItem("pcsl_s_showRandom"),do_random_anyway="1"===localStorage.getItem("pcsl_s_ignoreRule"),do_show_release="1"===localStorage.getItem("pcsl_s_showReleas"),do_longPress_copy="1"===localStorage.getItem("pcsl_s_LPressCopy")),do_display_hidden||$("#setting_hidden>div").toggleClass("selected"),do_select_input||$("#setting_select>div").toggleClass("selected"),do_show_random&&$("#setting_random>div").toggleClass("selected"),do_random_anyway&&$("#setting_ignore>div").toggleClass("selected"),do_show_release&&$("#setting_release>div").toggleClass("selected"),do_longPress_copy||$("#setting_copy>div").toggleClass("selected"),$("#nav_search_random").toggleClass("blank",!do_show_random),$(".setting_req_random").toggleClass("disabled",!do_show_random),init(),null!==e.get("sfilter")){var t=parseInt(e.get("sfilter")),s=[1&t?"":"nia",2&t?"":"momo",4&t?"":"kirara",8&t?"":"yuco",16&t?"":"shiro",32&t?"":"chui"];if("rep"===e.get("page")||null!==e.get("rfilter"))for(var r in s)""!==s[r]&&$(`.filter_icon${key_valid?"_extra":""}.icon_`+s[r]).click();if("search"===e.get("page")||null!==e.get("search"))for(var r in s)s[r].length&&$(".singer_icon.icon_"+s[r]).click()}var n=e.get("page");if("home"!==n&&-1===jump2page(n)&&jump2page("home"),null!==e.get("search")){"search"!==current_page&&jump2page("search");var o=e.get("search").split(",");if(o.length>1){var a=0;for(var r in o){(_=parseInt(o[r]))>=1&&_<song.length&&(hits[a++]=song_lookup[_])}is_searching_from_rep=1,loading="!bulk_load_flag",update_display(1)}else o>=1&&o<song.length&&($("#input").val(song[song_lookup[o]][song_idx.name]),$("#input").blur())}if(null!==e.get("rfilter")){"repertoire"!==current_page&&jump2page("rep");for(var i=[],_=parseInt(e.get("rfilter")),l=0;_;)_%2&&i.push(l),_>>=1,l++;for(var r in rep_anisong)i.includes(rep_anisong[r][1])||$("#anisong_"+r).click();for(var r in rep_genre)i.includes(rep_genre[r][1])||$("#general_"+r).click()}$("#loading_text").html("Loading Complete.<br />You can't see this tho"),$("#loading_overlay").addClass("hidden"),$("body").removeClass("allow_reload")}function init(){$("#input").val("");{const s=new Date("2021-01-01");function e(e){var t=new Date(s);return t.setDate(s.getDate()+e),t.toISOString().slice(0,10)}for(var t in video)video[t][video_idx.date]=e(video[t][video_idx.date]);for(var t in entry)entry[t][entry_idx.note]=note_index[entry[t][entry_idx.note]];note_index=null}for(var t in song)entry_proc[t]=[];for(t=0;t<entry.length;++t)entry[t][entry_idx.type]&&entry_proc[entry[t][0]].push(t);$("#info_version").html(version),$("#info_last-update").html(video[video.length-1][video_idx.date]),auto_display_max=Math.floor(5*Math.pow(window.innerHeight/window.innerWidth,1.41421356237));var s=[];for(t=1;t<song.length;++t)processed_song_name.push(song[t][song_idx.name].toLowerCase().normalize("NFKC"));for(t=0;t<song.length;++t){for(var r in rep_list[t]=0,entry_proc[t])rep_list[t]|=entry[entry_proc[t][r]][entry_idx.type];for(var r in s[t]=[...new Set(entry_proc[t])],rep_hits_solo[t]=[],s[t])rep_hits_solo[t]=rep_hits_solo[t].concat(split_to_solo(entry[s[t][r]][entry_idx.type]));rep_hits_solo[t]=[...new Set(rep_hits_solo[t])].filter(Number)}}function memcount_load_rep(){clearInterval(memcount_rep_int);for(var e=[],t=0;t<33;++t)e[t]=[];for(var t in rep_hits_solo)for(var s in rep_hits_solo[t]){var r=split_to_solo(rep_hits_solo[t][s]);for(var n in r)e[r[n]].push(t)}e.map((e=>[...new Set(e)]));var o=[e[4].length,e[2].length,e[1].length,e[32].length,e[16].length,e[8].length,new Set([...e[4],...e[32]]).size,new Set([...e[2],...e[16]]).size,new Set([...e[1],...e[8]]).size],a=[4,2,1,32,16,8,4,2,1],i="";for(t=0;t<(key_valid?6:3);++t)i+='<div class="memcount_rep_block"><div class="singer_'+a[t]+'m memcount_rep_name">'+singer_lookup[a[t]]+'</div><div class="singer_'+a[t]+'">'+o[t]+"</div></div>";if(key_valid){i+='<div></div><div class="memcount_rep_sum"></div><div></div>';for(t=6;t<9;++t)i+='<div class="memcount_rep_block_sum memcount_rep_singer_'+a[t]+'"><div>'+o[t]+"</div></div>"}$("#memcount_rep_content").toggleClass("extra_content",1===key_valid),$("#memcount_rep_content").html(i)}function display_date(e){var t="string"==typeof e?new Date(e):e;return t.getFullYear()+"-"+fill_digit(t.getMonth()+1,2)+"-"+fill_digit(t.getDate(),2)}function fill_digit(t,s){for(e=""+t;e.length<s;)e="0"+e;return e}function is_private(e){return entry[e][entry_idx.note].includes("非公開")||entry[e][entry_idx.note].includes("記録用")||entry[e][entry_idx.note].includes("アーカイブなし")}function bold(e,t){var s=e.toLowerCase().indexOf(t.toLowerCase());return-1===s||""===t?e:e.substring(0,s)+"<b>"+e.substring(s,s+t.length)+"</b>"+e.substring(s+t.length)}function copy_of(e){return"object"==typeof e?JSON.parse(JSON.stringify(e)):e}function get_last_sang(e,t=[4,2,1,32,16,8]){for(var s=entry_proc[e].length-1;s>=0;--s)if(t.some((t=>(t&entry[entry_proc[e][s]][entry_idx.type])===t)))return new Date(video[entry[entry_proc[e][s]][entry_idx.video]][video_idx.date]);return 0}function to8601(e){try{return new Date(e.substring(6),parseInt(e.substring(3,5))-1,e.substring(0,2))}catch{return-1}}null===theme&&(theme="mixed",localStorage.setItem("theme",theme)),document.documentElement.setAttribute("theme",theme),document.addEventListener("DOMContentLoaded",(async function(){var e;function t(t){return n?CryptoJS.AES.decrypt(t,e).toString(CryptoJS.enc.Utf8):t}if($(`#three_way_${localStorage.getItem("theme")}`).addClass("selected"),window.innerHeight/window.innerWidth<1.5)return $("#v_screen").addClass("post_switch"),$("#v_screen").height("100%"),$("#v_screen").width(.5625*window.innerHeight),$("#v_screen").attr("src","index.html"+window.location.search),$("body > div").addClass("post_switch"),void $("body").addClass("post_switch");var s=new URLSearchParams(window.location.search);e=s.get("key");var r=!0,n=0;if(""!==getCookie("pcsl_content_key")&&(localStorage.setItem("pcsl_key",getCookie("pcsl_content_key")),removeCookie("pcsl_content_key")),await getSHA384Hash(localStorage.getItem("pcsl_key"))===key_hash[1]?(n=2,e=localStorage.getItem("pcsl_key")):""!==e&&await getSHA384Hash(e)===key_hash[1]?(n=2,r=!1,localStorage.setItem("pcsl_key",e)):await getSHA384Hash(localStorage.getItem("pcsl_key"))===key_hash[0]?(n=1,e=localStorage.getItem("pcsl_key")):""!==e&&await getSHA384Hash(e)===key_hash[0]&&(n=1,r=!1,localStorage.setItem("pcsl_key",e)),key_valid=n?1:0,localStorage.getItem("pcsl_version_hash")===version_hash&&r){var o=localStorage.getItem("pcsl_data").split("\n");video=JSON.parse(t(o[0])),entry=JSON.parse(t(o[1])),process_data()}else $("#loading_text").html("Downloading data..."),fetch(`data_${n}.txt`).then((e=>(e.ok||$("#loading_text").html("Failed to download data.<br />Please reload to try again.<br /><br />Contact site administrator<br />if this problem persists."),e.text()))).then((e=>{const s=e.split("\n");video=JSON.parse(t(s[0])),entry=JSON.parse(t(s[1])),localStorage.setItem("pcsl_data",e),localStorage.setItem("pcsl_version_hash",version_hash),process_data()}));key_valid?(member_display_order=[7,6,5,3,4,2,1,32,16,8],$(".extra").removeClass("hidden"),$(".memcount_subblock").removeClass("anti_extra"),$(".anti_extra").html(""),$(".anti_extra").addClass("hidden"),$("#home_key").removeClass("hidden"),$("#filter_entry_icon_container").addClass("hidden"),$("#filter_entry_icon_extra").removeClass("hidden")):part_filter=[1,1,1,0,0,0]})),$((function(){$(document).on("click","#nav_menu",(function(e){e.preventDefault(),prevent_menu_popup||($("#menu_container").toggleClass("hidden"),$("#nav_menu").toggleClass("menu_opened"),$(document.body).toggleClass("no_scroll"))})),$(document).on("click","#nav_to_top",(function(e){if(e.preventDefault(),!prevent_menu_popup){var t=$("html,body").scrollTop(),s=t/33,r=setInterval((function(){t-=s,$("html,body").scrollTop(t),t<=0&&clearInterval(r)}),1);"repertoire"===current_page&&rep_display_selected_first&&rep_display()}})),$(document).on("click","#menu_container",(function(e){$(e.target).parents(".defog").length||$(e.target).hasClass("defog")||($("#menu_container").addClass("hidden"),$("#nav_menu").removeClass("menu_opened"),$(document.body).removeClass("no_scroll"))})),$(document).on("click",".menu2page",(function(e){var t=$(e.target).attr("id").replace("menu2page_","");t!==current_page&&(jump2page(t),$("#menu_container").addClass("hidden"),$("#nav_menu").removeClass("menu_opened"),$(document.body).removeClass("no_scroll"))})),$(document).on("click","#menu_setting",(function(){$("#popup_container").removeClass("hidden"),$("#settings").removeClass("hidden"),$("#menu_container").addClass("hidden"),$("#nav_menu").removeClass("menu_opened"),prevent_menu_popup=!0})),$(document).on("click","#menu_count",(function(){if($("#popup_container").removeClass("hidden"),$("#memcount").removeClass("hidden"),$("#menu_container").addClass("hidden"),$("#nav_menu").removeClass("menu_opened"),prevent_menu_popup=!0,""===$("#memcount_content").html()){for(var e=[],t=0;t<33;++t)e[t]=[0,0,0];for(t=0;t<entry.length;++t)is_private(t)?e[entry[t][entry_idx.type]][2]++:entry[t][entry_idx.note].includes("【メン限")?e[entry[t][entry_idx.type]][1]++:e[entry[t][entry_idx.type]][0]++;var s='<table id="memcount_table"><tr><th></th><th>通常</th><th>メン限</th><th>非公開</th></tr>';for(var t in member_display_order){var r=member_display_order[t];s+='<tr class="memcount_row singer_'+r+'"><td><div class="memcount_name">'+singer_lookup[r]+"</div></td>";for(var n=0;n<3;++n)s+="<td"+(0===e[r][n]?' class="memcount_empty"':"")+">"+e[r][n]+"</td>";s+="</tr>"}var o=[0,0,0,0,0,0];for(var t in entry){var a=split_to_solo(entry[t][entry_idx.type]);for(var n in a)o[part_rom.indexOf(a[n])]++}if(key_valid){s+='</table><div id="memcount_sum_warpper" class="memcount_sum"><div class="memcount_sum_icon col-1 colspan-2"></div>';for(var i=0;i<2;++i)for(var _=2;_>=0;--_)s+='<div class="row-'+(i+1)+" col-"+(4-_)+" singer_"+(1<<3*i+_)+'">'+o[3*i+_]+"</div>"}else{s+='</table><div class="memcount_sum"><div class="memcount_sum_icon"></div>';for(t=2;t>=0;--t)s+='<div class="singer_'+(1<<t)+'">'+o[t]+"</div>"}$("#memcount_content").html(s+"</div>"),memcount_rep_int=setInterval(memcount_load_rep,1)}})),$(document).on("click","#menu_info",(function(){$("#popup_container").removeClass("hidden"),$("#information").removeClass("hidden"),$("#menu_container").addClass("hidden"),$("#nav_menu").removeClass("menu_opened"),prevent_menu_popup=!0})),$(document).on("click",".three_way>div",(function(){var e=$(this).attr("id").replace("three_way_","");document.documentElement.setAttribute("theme",e),localStorage.setItem("theme",e),$(".three_way>div").removeClass("selected"),$(this).addClass("selected"),parent.refresh_bgColour()})),$(document).on("click",".two_way:not(.disabled)",(function(){switch($(this).children().toggleClass("selected"),this.id){case"setting_hidden":do_display_hidden^=1,localStorage.setItem("pcsl_s_showHidden",do_display_hidden?"1":"0");break;case"setting_select":do_select_input^=1,localStorage.setItem("pcsl_s_selecInput",do_select_input?"1":"0");break;case"setting_random":do_show_random^=1,$("#nav_search_random").toggleClass("blank",do_show_random),localStorage.setItem("pcsl_s_showRandom",do_show_random?"1":"0"),$(".setting_req_random").toggleClass("disabled",!do_show_random);break;case"setting_ignore":do_random_anyway^=1,$("#nav_search_random").toggleClass("disabled",!searching_song_name||!do_random_anyway&&""!==loading),localStorage.setItem("pcsl_s_ignoreRule",do_random_anyway?"1":"0");break;case"setting_release":do_show_release^=1,localStorage.setItem("pcsl_s_showReleas",do_show_release?"1":"0"),"repertoire"===current_page&&rep_display();break;case"setting_copy":do_longPress_copy^=1,localStorage.setItem("pcsl_s_LPressCopy",do_longPress_copy?"1":"0")}})),$(document).on("click","#memcount, #memcount_rep",(function(e){$(e.target).closest(".popup_frame").length&&$(".memcount_subblock").toggleClass("hidden")})),$(document).on("click","#popup_container",(function(e){$(e.target).closest(".popup_frame").length||$(e.target).find("#rep_list:not(.hidden)").length||($(".popup_frame").addClass("hidden"),$("#popup_container").addClass("hidden"),$(document.body).removeClass("no_scroll"),prevent_menu_popup=!1)})),$(document).on("click","#home_key_reset",(function(){$("#popup_container").removeClass("hidden"),$("#remove_key").removeClass("hidden"),$("#menu_container").addClass("hidden"),$("#nav_menu").removeClass("menu_opened"),$(document.body).addClass("no_scroll"),prevent_menu_popup=!0})),$(document).on("click","#remove_key_yes",(function(){localStorage.setItem("pcsl_version_hash",""),localStorage.setItem("pcsl_key",""),window.location=window.location.href.split("?")[0]})),$(document).on("click","#remove_key_nah",(function(){$("#remove_key").addClass("hidden"),$("#popup_container").addClass("hidden"),$(document.body).removeClass("no_scroll"),prevent_menu_popup=!1}))}));var today=(new Date).setHours(0,0,0,0);function get_date_different(e,t=today){return e="string"==typeof e?new Date(e):e,t=void 0===t?t:new Date(t),Math.round(Math.abs(e-t)/864e5)}function get_sang_count(e,t=[4,2,1,32,16,8]){var s=0,r=0;for(var n in entry_proc[e])t.some((t=>(t&entry[entry_proc[e][n]][entry_idx.type])===t))&&(s++,entry[entry_proc[e][n]][entry_idx.note].includes("【メン限")&&r++);return[s,r]}function jump2page(e){switch(current_page=e="rep"===e?"repertoire":e,$(".menu2page_selected").removeClass("menu2page_selected"),$("#menu2page_"+e).addClass("menu2page_selected"),$(".section_container").addClass("hidden"),$("#"+e+"_section").removeClass("hidden"),$("#nav_dummy").addClass("hidden"),$("#nav_search_random").addClass("hidden"),$("#nav_bulk_search").addClass("hidden"),$("#nav_share").addClass("hidden"),$("#search_display").html(""),$("#rep_display").html(""),e){case"home":$("#nav_title").html("ホーム"),$("#nav_dummy").removeClass("hidden");break;case"search":$("#nav_search_random").removeClass("hidden"),$("#nav_share").removeClass("hidden"),$("#nav_share").toggleClass("disabled",!is_searching_from_rep),$("#nav_title").html("曲検索"),$("#input").val(""),search();break;case"rep":case"repertoire":$("#repertoire_section").removeClass("hidden"),$("#nav_bulk_search").removeClass("hidden"),$("#nav_share").removeClass("hidden"),$("#nav_share").toggleClass("disabled",!rep_selected.length),$("#nav_title").html("レパートリー"),rep_input_memory="",rep_search();break;default:return-1}$(window).scrollTop(0)}function split_to_solo(e){switch(e){case 3:return[1,2];case 5:return[1,4];case 6:return[2,4];case 7:return[1,2,4];case 12:return[4,8];default:return[e]}}var copy_popup_is_displaying=!1;function copy_popup(){copy_popup_is_displaying||(copy_popup_is_displaying=!0,$("#copy_popup").attr("class","fade_out"),setTimeout((()=>{copy_popup_is_displaying=!1,$("#copy_popup").attr("class","hidden")}),1500))}function to_html(e){return e.replaceAll('"',"&quot;").replaceAll("'","&apos;")}function to_non_html(e){return e.replaceAll("&quot;",'"').replaceAll("&apos;","'")}const getSHA384Hash=async e=>{const t=(new TextEncoder).encode(e),s=await window.crypto.subtle.digest("SHA-384",t);return Array.from(new Uint8Array(s)).map((e=>e.toString(16).padStart(2,"0"))).join("")};function getCookie(e){let t=e+"=",s=document.cookie.split(";");for(let e=0;e<s.length;e++){let r=s[e];for(;" "==r.charAt(0);)r=r.substring(1);if(0==r.indexOf(t))return r.substring(t.length,r.length)}return""}function removeCookie(e){document.cookie=e+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/"}function refresh_bgColour(){document.documentElement.setAttribute("theme",localStorage.getItem("theme"))}var loading="",part_filter=[1,1,1,1,1,1];const part_rom=[1,2,4,8,16,32];var auto_display_max,hide_song=new Array,searching_song_name=!0,search_sort_by_date=!0,search_sort_asd=!0,is_searching_from_rep=!1,search_input_focused=!1;$((function(){$(document).on("click","#nav_search_random",(function(){if(!($(this).hasClass("disabled")&&!do_random_anyway||prevent_menu_popup)){var e,t=sel_member=0;for(var s in part_filter)part_filter[s]&&(sel_member+=part_rom[s]);if(0!==sel_member){do{for(var s in e=1+Math.floor(Math.random()*song.length),entry_proc[e])if(rep_list[e]&sel_member&&(do_display_hidden||!is_private(entry_proc[e][s]))){t++;break}}while(0===t);$("#input").val(song[e][song_idx.name]),is_searching_from_rep=0,search()}}})),$(document).on("click","#nav_share",(function(){if("search"===current_page&&!$(this).hasClass("disabled")&&!prevent_menu_popup){for(var e="szk31.github.io/pcsl/?search="+song_lookup.indexOf(hits[0]),t=1;t<hits.length;++t)e+=","+song_lookup.indexOf(hits[t]);navigator.clipboard.writeText(e),copy_popup()}})),$(document).on("input","#input",(function(){auto_search()})),$(document).on("mousedown",".auto_panel",(function(){var e=to_non_html($(this).attr("id"));$("#input").val(e)})),$(document).on("blur","#input",(function(){$("#search_auto").addClass("hidden"),search_input_focused=!1,is_searching_from_rep?is_searching_from_rep=0:$("#nav_share").toggleClass("disabled",!is_searching_from_rep),search()})),$(document).on("keydown",(function(e){13===e.keyCode&&"search"===current_page&&$("#input").blur()})),$(document).on("click","#input",(function(){if(!search_input_focused){if(search_input_focused=!0,do_select_input){var e=this;setTimeout((function(){e.setSelectionRange(0,$(e).val().length)}),0)}else"!bulk_load_flag"===loading&&($(this).val(""),$("#nav_search_random").removeClass("disabled"),$("#nav_share").addClass("disabled"));auto_search()}})),$(document).on("click","#search_options_button",(function(){$("#search_options_button").toggleClass("opened"),$("#search_options_container").toggleClass("hidden")})),$(document).on("click",".singer_icon",(function(){var e=parseInt($(this).attr("class").split(/\s+/).find((e=>e.startsWith("sing_sel_"))).replace("sing_sel_",""));part_filter[part_rom.indexOf(e)]^=1,$(".sing_sel_"+e).toggleClass("selected"),loading="",search()})),$(document).on("click",".search_option_group1",(function(){var e="songname"===$(this).attr("id").replace(/(search_options_)/,"");e!==searching_song_name&&(searching_song_name=e,$(".search_option_group1>.radio").toggleClass("selected"),$("#input").val(""),$("#nav_share").addClass("disabled"),$("#input").attr("placeholder",searching_song_name?"曲名/読みで検索":"アーティスト名で検索"),$("#search_display").html(""),loading="",$("#nav_search_random").toggleClass("disabled",!searching_song_name))})),$(document).on("click",".search_option_group2",(function(){var e="date"===$(this).attr("id").replace(/(search_options_)/,"");search_sort_by_date!==e&&(search_sort_by_date=e,$(".search_option_group2>.radio").toggleClass("selected"),update_display(),$("#search_options_asd>.attr_name").html(search_sort_by_date?search_sort_asd?"古い順&nbsp;(⇌新しい順)":"新しい順&nbsp;(⇌古い順)":search_sort_asd?"正順&nbsp;(⇌逆順)":"逆順&nbsp;(⇌正順)"))})),$(document).on("click",".search_option_group3",(function(){search_sort_asd^=1,$("#search_options_asd>.attr_name").html(search_sort_by_date?search_sort_asd?"古い順&nbsp;(⇌新しい順)":"新しい順&nbsp;(⇌古い順)":search_sort_asd?"正順&nbsp;(⇌逆順)":"逆順&nbsp;(⇌正順)"),update_display()})),$(document).on("click",".song_name_container",(function(e){if(!$(e.target).hasClass("song_copy_icon")){var t=parseInt($(this).attr("id"));hide_song.includes(t)?hide_song.splice(hide_song.indexOf(t),1):hide_song.push(t),$(".song_"+t).toggleClass("hidden"),$("#fold_"+t).toggleClass("closed")}})),$(document).on("click",".song_copy_icon",(function(){var e=parseInt($(this).attr("id").replace("copy_name_",""));navigator.clipboard.writeText(song[e][song_idx.name]),copy_popup()})),$(document).on("click",".entry_share",(function(){var e=parseInt($(this).attr("id").replace("entry_",""));const t="https://www.youtube.com/watch?v="+video[entry[e][entry_idx.video]][video_idx.id];fetch("https://noembed.com/embed?dataType=json&url="+t).then((e=>e.json())).then((function(t){var s;void 0!==t.title?(s=0===entry[e][entry_idx.time]?t.title+"\n(youtu.be/"+video[entry[e][entry_idx.video]][video_idx.id]+")":song[entry[e][entry_idx.song_id]][song_idx.name].trim()+" / "+song[entry[e][entry_idx.song_id]][song_idx.artist]+" @"+t.title+"\n(youtu.be/"+video[entry[e][entry_idx.video]][video_idx.id]+timestamp(e)+")",window.open("https://twitter.com/intent/tweet?text="+encodeURIComponent(s),"_blank")):alert("動画タイトル取得できませんでした。")}))}))}));var hits=[];function auto_search(){var e=$("#input").val().normalize("NFKC").toLowerCase().trim();if(""!==e&&searching_song_name){var t=[],s=[],r=0,n=0;for(var o in series_lookup)for(var a in series_lookup[o]){if(-1!==(_=series_lookup[o][a].indexOf(e))){t[r++]=o;break}}if(/[^\u3040-\u309F\u30FC\u30F4]/.test(e)){for(o=1;o<song.length;++o)if(!(o>2&&song[o][song_idx.name].trim()===song[o-1][song_idx.name].trim())){if(-1===(_=song[o][song_idx.name].toLowerCase().indexOf(e))){var i=song[o][song_idx.reading].indexOf(" ");i>0&&song[o][song_idx.reading].indexOf(e)>i&&(_=1)}switch(_){case 0:entry_proc[o].length>0&&(t[r++]=o);break;case-1:break;default:entry_proc[o].length>0&&(s[n++]=o);break}if(r>=auto_display_max)break}}else for(var o=1;o<song.length;++o)if(!(o>2&&song[o][song_idx.name].trim()===song[o-1][song_idx.name].trim())){var _;switch(_=song[o][song_idx.reading].indexOf(e)){case 0:entry_proc[o].length>0&&(t[r++]=o);break;case-1:break;default:entry_proc[o].length>0&&(s[n++]=o);break}if(r>=auto_display_max)break}var l=0,d="";for(var o in t){var c,p,g;if(isNaN(parseInt(t[o])))c="",p=g=t[o];else{var m=song[t[o]][song_idx.reading];c=-1===m.indexOf(" ")?bold(m,e):bold(m.substring(0,m.indexOf(" ")),e),p=bold(g=song[t[o]][song_idx.name],e)}d+='<div id="'+to_html(g)+'" class="auto_panel'+(0===l?" auto_first":"")+'"><div class="auto_reading">'+c+'</div><div class="auto_display">'+p+"</div></div>",l++}for(var o in s)if(d+='<div id="'+to_html(song[s[o]][song_idx.name])+'" class="auto_panel'+(0===l?" auto_first":"")+'"><div class="auto_reading"></div><div class="auto_display">'+bold(song[s[o]][song_idx.name],e)+"</div></div>",++l>=auto_display_max)break;$("#search_auto").html(d),""!==d?$("#search_auto").removeClass("hidden"):$("#search_auto").addClass("hidden")}else $("#search_auto").addClass("hidden")}function search(){if(is_searching_from_rep)update_display();else{var e=$("#input").val().trim();if(e!==loading){if(loading=e,""===e)return $("#search_display").html(""),void $("#nav_search_random").removeClass("disabled");do_random_anyway||$("#nav_search_random").addClass("disabled"),e=e.normalize("NFKC").toLowerCase();var t="";for(var s in series_lookup){for(var r in series_lookup[s])if(series_lookup[s].includes(e)){t=s;break}if(""!==t)break}var n=0;if(""!=t){var o=[2,3,4,7];for(var s in o)if(attr_idx[o[s]]===t){n=o[s];break}}hits=[];for(s=1;s<song.length&&200!==hits.length;++s)if(searching_song_name)if(""!==t){if(song[s][song_idx.reading].includes(t)){hits.push(s);continue}n&&1<<n&song[s][song_idx.attr]&&hits.push(s)}else(processed_song_name[s].includes(e)||song[s][song_idx.reading].toLowerCase().includes(e))&&hits.push(s);else song[s][song_idx.artist].toLowerCase().includes(e)&&hits.push(s);$("#nav_share").toggleClass("disabled",searching_song_name||0===hits),hits.sort((function(t,s){return song[t][song_idx.name].trim().toLowerCase()===e?song[s][song_idx.name].trim().toLowerCase()===e?0:-1:song[s][song_idx.name].trim().toLowerCase()===e?1:void 0})),update_display()}}}function update_display(e=!1){if(e|=is_searching_from_rep,$("#search_auto").addClass("hidden"),""!==loading||e){for(var t=-1,s=[],r=0,n="",o=0,a=0,i=0;i<hits.length;++i){var _=[];a+=(_=search_sort_by_date?entry_proc[hits[i]].sort(((e,t)=>search_sort_asd?e-t:t-e)):entry_proc[hits[i]].sort(((e,t)=>entry[e][entry_idx.type]===entry[t][entry_idx.type]?e-t:(search_sort_asd?1:-1)*(display_order[entry[e][entry_idx.type]]-display_order[entry[t][entry_idx.type]])))).length;for(var l=0;l<_.length;++l){var d=_[l],c=!0;for(var p in part_filter)if(part_filter[p]&&part_rom[p]&entry[d][entry_idx.type]){c=!1;break}if(!(c||!do_display_hidden&&is_private(d))){if(t!==entry[d][entry_idx.song_id]){n+=(-1!==t?"</div>":"")+'<div class="song_container">',t=entry[d][entry_idx.song_id],s[r++]=t;var g=!hide_song.includes(t),m=song[t][song_idx.name].normalize("NFKC"),h=0;for(p=0;p<m.length;++p)h+=/[ -~]/.test(m.charAt(p))?1:2;"secret base ~君がくれたもの~"===m&&(h=0),"みくみくにしてあげる♪【してやんよ】"===m&&(m="みくみくにしてあげる♪<br />【してやんよ】"),/([^~]+~+[^~])/g.test(m)&&h>=28&&(m=m.substring(0,m.search(/~/g))+"<br />"+m.substring(m.search(/~/g))),n+='<div class="song_name_container '+(r%2?"odd_colour":"even_colour")+'" id="'+t+'"><div class="song_rap"><div class="song_name">'+m+'</div><div class="song_credit'+(g?"":" hidden")+(song[t][song_idx.artist].length>30?" long_credit":"")+" song_"+t+'">'+song[t][song_idx.artist]+'</div></div><div class="song_icon_container"><div id="fold_'+t+'" class="song_fold_icon'+(g?"":" closed")+'"></div><div id="copy_name_'+t+'" class="song_copy_icon song_'+t+(g?"":" hidden")+'"></div></div></div>'}var u=entry[d][entry_idx.note].includes("【メン限"),v=""===entry[d][entry_idx.note]||"【メン限】"===entry[d][entry_idx.note]||"【メン限アーカイブ】"===entry[d][entry_idx.note],f=entry[d][entry_idx.note];if(u&&(f=f.replace(/【メン限アーカイブ】|【メン限】/g,"")),n+='<div class="entry_container singer_'+entry[d][entry_idx.type]+(u?"m":"")+" song_"+t+(hide_song.includes(t)?" hidden":"")+'"><a href="https://youtu.be/'+video[entry[d][entry_idx.video]][video_idx.id]+timestamp(d)+'" target="_blank"><div class="entry_primary"><div class="entry_date">'+display_date(video[entry[d][entry_idx.video]][video_idx.date])+'</div><div class="entry_singer">'+singer_lookup[entry[d][entry_idx.type]]+'</div><div class="mem_display">'+(u?"メン限":"")+'</div><div class="entry_share" id="entry_'+d+'" onclick="return false;"></div></div>'+(v?"":'<div class="entry_note">'+f+"</div>")+"</a></div>",++o>=400){i=200;break}}}}do{if(""!==n)break;if(0===hits.length){n+='<div class="search_no_result">曲検索結果なし';break}if(a>0){n+='<div class="search_no_result">非表示動画のみ';break}n+='<div class="search_no_result">歌記録なし'}while(0);$("#search_display").html(n+'</div><div class="general_vertical_space"></div>');for(i=0;i<hide_song.length;++i)s.includes(hide_song[i])||hide_song.splice(i--,1)}}function timestamp(e){return 0===entry[e][entry_idx.time]?"":"?t="+entry[e][entry_idx.time]}var attr_idx=["others","アニソン","ラブライブ","アイマス","マクロス","J-POP","ボカロ","ジブリ","特撮","ロック","歌謡曲","ポップス","R&B","キャラソン","disney"],rep_list=[],rep_singer=[1,1,1,1,1,1],rep_anisong={lovelive:[1,2],imas:[1,3],macros:[1,4],other:[1,1]},rep_genre={jpop:[1,5],voc:[1,6],jib:[1,7],tok:[1,8],rock:[1,9],kay:[1,10],pops:[1,11],rnb:[1,12],cha:[1,13],dis:[1,14],other:[1,0]},oke_gone=["ノーザンクロス"],rep_sort="50",rep_sort_asd=!0,rep_display_selected_first=!1,rep_edit_selected=-1,selected_member=[4,2,1,32,16,8];const selected_member_ram=[4,2,1,32,16,8],name_lookup=["kirara","momo","nia","chui","shiro","yuco"],exist=e=>selected_member.includes(e);var longpress_timer,post_longpress_timer,is_long_pressing=!1;$((function(){$(document).on("blur","#rep_input",(function(){rep_search()})),$(document).on("keydown",(function(e){13===e.keyCode&&"repertoire"===current_page&&$("#rep_input").blur()})),$(document).on("click",".filter_title",(function(){var e=$(this).attr("id").replace(/(filter_)|(_title)/g,"");$("#filter_"+e+"_close").toggleClass("closed"),$("#filter_"+e+"_content").toggleClass("hidden")})),$(document).on("click",".filter_icon, .filter_icon_extra",(function(){var e=$(this).attr("class").split(/\s+/).find((e=>e.startsWith("icon_"))).replace("icon_","");rep_singer[name_lookup.indexOf(e)]^=1,$(this).toggleClass("selected"),rep_search(!0)})),$(document).on("click",".filter_entry_attr_item",(function(){var e=$(this).attr("id").replace(/(attr_container_)/,"");if("all"===e)for(var t in $(".attr_checkbox").toggleClass("selected",!$("#attr_"+e).hasClass("selected")),rep_attr)rep_attr[t]=$("#attr_"+e).hasClass("selected")?1:0;else if($("#attr_"+e).toggleClass("selected"),rep_attr[e]^=1,$("#attr_"+e).hasClass("selected")){for(var t in rep_attr)if(!rep_attr[t])return void rep_search();$("#attr_all").addClass("selected")}else $("#attr_all").removeClass("selected");rep_search()})),$(document).on("click",".filter_genre_anisong_item",(function(){var e=$(this).attr("id").replace(/(genre_container_anisong_)/,"");if("all"===e)for(var t in $(".genre_anisong_checkbox").toggleClass("selected",!$("#anisong_all").hasClass("selected")),rep_anisong)rep_anisong[t][0]=$("#anisong_all").hasClass("selected")?1:0;else if($("#anisong_"+e).toggleClass("selected"),rep_anisong[e][0]^=1,$("#anisong_"+e).hasClass("selected")){for(var t in rep_anisong)if(!rep_anisong[t][0])return void rep_search();$("#anisong_all").addClass("selected")}else $("#anisong_all").removeClass("selected");rep_search()})),$(document).on("click",".filter_genre_general_item",(function(){var e=$(this).attr("id").replace(/(genre_container_general_)/,"");if("all"===e)for(var t in $(".genre_general_checkbox").toggleClass("selected",!$("#general_all").hasClass("selected")),rep_genre)rep_genre[t][0]=$("#general_all").hasClass("selected")?1:0;else if($("#general_"+e).toggleClass("selected"),rep_genre[e][0]^=1,$("#general_"+e).hasClass("selected")){for(var t in rep_genre)if(!rep_genre[t][0])return void rep_search();$("#general_all").addClass("selected")}else $("#general_all").removeClass("selected");rep_search()})),$(document).on("click",".filter_sort_item",(function(){var e=$(this).attr("id").replace(/(sort_container_)/,"");rep_sort!==e&&($(".sort_checkbox").removeClass("selected"),$("#sort_"+e).addClass("selected"),rep_sort=e,update_rep_sort_display(),rep_display())})),$(document).on("click",".filter_sort2_item",(function(){rep_sort_asd^=1,update_rep_sort_display(),rep_display()})),$(document).on("click",".filter_sort3_item",(function(){rep_display_selected_first^=1,$(".sort3_checkbox").toggleClass("selected",rep_display_selected_first),rep_display()})),$(document).on("click",".rep_song_container",(function(){if(!is_long_pressing){var e=parseInt($(this).attr("id").replace(/(rep_song_)/,""));$(this).hasClass("selected")?(rep_selected.splice(rep_selected.indexOf(e),1),0===rep_selected.length&&($("#nav_share").addClass("disabled"),$("#nav_bulk_search").addClass("disabled"))):(rep_selected.push(e),$("#nav_share").removeClass("disabled"),$("#nav_bulk_search").removeClass("disabled")),$(this).toggleClass("selected")}})),$(document).on("mousedown touchstart",".rep_song_container",(function(){if(do_longPress_copy){var e=parseInt($(this).attr("id").replace(/(rep_song_)/,""));longpress_timer=setTimeout((function(){navigator.clipboard.writeText(song[e][song_idx.name]),copy_popup(),is_long_pressing=!0,post_longpress_timer=setTimeout((function(){is_long_pressing=!1,clearTimeout(post_longpress_timer)}),500)}),600)}})),$(document).on("mouseup mouseleft touchend touchmove",".rep_song_container",(function(){clearTimeout(longpress_timer)})),$(document).on("click","#nav_bulk_search",(function(){is_searching_from_rep=1,jump2page("search"),hits=copy_of(rep_selected),loading="!bulk_load_flag",$("#input").val(""),update_display(1)})),$(document).on("click","#nav_share",(function(){"repertoire"===current_page&&($(this).hasClass("disabled")||prevent_menu_popup||(prevent_menu_popup=!0,$(document.body).toggleClass("no_scroll"),$("#rep_list").removeClass("hidden"),$("#popup_container").removeClass("hidden"),rep_update_list()))})),$(document).on("click","#rep_list_artist",(function(){$("#rep_list_artist").hasClass("disabled")||($("#list_artist_cb").toggleClass("selected"),rep_update_list())})),$(document).on("click","#rep_list_edit",(function(){0!==rep_selected.length&&(-1===rep_edit_selected?($("#rep_list_edit").html("編集終了"),$("#rep_list_artist").addClass("disabled"),$("#rep_list_close").addClass("disabled"),$("#rep_compose_tweet").addClass("disabled"),$("#rep_list_leftbar").removeClass("hidden"),$("#rep_list_container").addClass("editing"),rep_edit_selected=-2,rep_update_leftbar()):($("#rep_list_edit").html("編集"),$("#rep_list_artist").removeClass("disabled"),$("#rep_list_close").removeClass("disabled"),$("#rep_compose_tweet").removeClass("disabled"),$("#rep_list_leftbar").addClass("hidden"),$("#rep_list_container").removeClass("editing"),rep_edit_selected=-1))})),$(document).on("click",".rep_list_item",(function(){var e=parseInt($(this).attr("id").replace(/(rep_btn_)/,""));switch(rep_edit_selected){case-1:return;break;case-2:rep_edit_selected=e,rep_update_leftbar();break;case e:rep_edit_selected=-2,rep_update_leftbar();break;default:if($(this).hasClass("arrow_up")){[rep_selected[e],rep_selected[e+1]]=[rep_selected[e+1],rep_selected[e]],rep_edit_selected--,rep_update_list(),rep_update_leftbar();var t=Math.max(0,rep_edit_selected-1),s=$("#rep_list_leftbar").offset().top,r=$("#rep_btn_"+t).offset().top;r<s&&($("#rep_list_leftbar").scrollTop($("#rep_list_leftbar").scrollTop()-s+r),$("#rep_list_content").scrollTop($("#rep_list_leftbar").scrollTop()))}if($(this).hasClass("arrow_down")){[rep_selected[e-1],rep_selected[e]]=[rep_selected[e],rep_selected[e-1]],rep_edit_selected++,rep_update_list(),rep_update_leftbar();t=Math.min(rep_edit_selected+1,rep_selected.length-1);var n=$("#rep_list_leftbar").offset().top+$("#rep_list_leftbar").height(),o=$("#rep_btn_"+t).offset().top+$("#rep_btn_"+t).height();o>n&&($("#rep_list_leftbar").scrollTop($("#rep_list_leftbar").scrollTop()-n+o),$("#rep_list_content").scrollTop($("#rep_list_leftbar").scrollTop()))}break}})),$(document).on("click",".rep_list_delete",(function(){rep_edit_selected>=0&&($("#rep_song_"+rep_selected[rep_edit_selected]).removeClass("selected"),rep_selected.splice(rep_edit_selected,1)),rep_edit_selected=-2,rep_update_list(),rep_update_leftbar(),0===rep_selected.length&&($("#rep_list_edit").html("編集"),$("#rep_list_artist").removeClass("disabled"),$("#rep_list_close").removeClass("disabled"),$("#rep_compose_tweet").removeClass("disabled"),$("#rep_list_leftbar").addClass("hidden"),$("#rep_list_container").removeClass("editing"),rep_edit_selected=-1,$("#nav_share").addClass("disabled"),$("#nav_bulk_search").addClass("disabled"))})),$("#rep_list_content").on("scroll",(function(){$("#rep_list_leftbar").scrollTop($("#rep_list_content").scrollTop())})),$(document).on("click","#rep_list_close",(function(){$("#rep_list_close").hasClass("disabled")||(prevent_menu_popup=!1,$("#rep_list").addClass("hidden"),$("#popup_container").addClass("hidden"),$(document.body).toggleClass("no_scroll"))})),$(document).on("click","#rep_compose_tweet",(function(){if(!$("#rep_compose_tweet").hasClass("disabled")&&0!==rep_selected.length){prevent_menu_popup=!1,$("#rep_list").addClass("hidden"),$("#popup_container").addClass("hidden"),$(document.body).toggleClass("no_scroll");var e="";for(var t in rep_selected)e+=song[rep_selected[t]][song_idx.name]+($("#list_artist_cb").hasClass("selected")?" / "+song[rep_selected[t]][song_idx.artist]:"")+"\n";window.open("https://twitter.com/intent/tweet?text="+encodeURIComponent(e),"_blank")}})),$(document).on("click","#rep_copy",(function(){var e="";for(var t in rep_selected)e+=song[rep_selected[t]][song_idx.name]+($("#list_artist_cb").hasClass("selected")?" / "+song[rep_selected[t]][song_idx.artist]:"")+"\n";navigator.clipboard.writeText(e),copy_popup()}))}));var rep_display_inter,rep_hits=[],rep_hits_solo=[],rep_hits_count=0,rep_selected=[],rep_input_memory="";function rep_search(e=!1){var t=$("#rep_input").val().normalize("NFKC").trim();if(t!==rep_input_memory)rep_input_memory=t;else if(!e&&""!==t)return;for(var s in selected_member=[],selected_member_ram)rep_singer[s]&&selected_member.push(selected_member_ram[s]);if(""===rep_input_memory){if(0===selected_member.length)return clearInterval(rep_display_inter),void $("#rep_display").html("");var r=0;for(var s in rep_hits=[],rep_hits_count=0,rep_anisong)r+=rep_anisong[s][0]<<rep_anisong[s][1];for(var s in rep_genre)r+=rep_genre[s][0]<<rep_genre[s][1];var n=0;for(var s in rep_anisong)"other"!==s&&(n+=1-rep_anisong[s][0]<<rep_anisong[s][1]);for(s=0;s<song.length;++s)if(song[s][song_idx.attr]&r){if(0!=n&&song[s][song_idx.attr]&n)continue;if(!rep_hits_solo[s].some(exist))continue;rep_hits[rep_hits_count++]=s}rep_display()}else{rep_hits=[],rep_hits_count=0;for(var s=1;s<song.length;++s)0!==entry_proc[s].length&&(-1===processed_song_name[s].search(t.toLowerCase())&&-1===song[s][song_idx.reading].search(t)||(rep_hits[rep_hits_count++]=s));rep_display()}}function rep_display(){if(rep_display_selected_first)for(var e in rep_selected)-1!==rep_hits.indexOf(rep_selected[e])&&rep_hits.splice(rep_hits.indexOf(rep_selected[e]),1);switch($("#rep_display").html(""),rep_sort){case"50":rep_hits.sort(((e,t)=>e-t)),rep_sort_asd||rep_hits.reverse();break;case"count":var t=[];for(var e in song)if(6!==selected_member.length)for(var s in t[e]=0,entry_proc[e])selected_member.includes(entry[entry_proc[e][s]][entry_idx.type])&&t[e]++;else t[e]=entry_proc[e].length;rep_hits.sort(((e,s)=>(rep_sort_asd?1:-1)*(t[s]-t[e])));break;case"date":var r=[];for(var e in song){var n=get_last_sang(e,selected_member);r[e]=n?n.getTime():0}rep_hits.sort(((e,t)=>(rep_sort_asd?1:-1)*(r[t]-r[e])));break;case"release":for(r=[],e=1;e<song.length;++e)r[e]=to8601(song[e][song_idx.release]).getTime();rep_hits.sort(((e,t)=>(rep_sort_asd?1:-1)*(r[t]-r[e])));break;default:return}rep_display_selected_first&&(rep_hits=rep_selected.concat(rep_hits)),rep_loading_progress=0,rep_display_loop(),clearInterval(rep_display_inter),rep_display_inter=setInterval(rep_display_loop,10)}var rep_loading_progress=0;function rep_display_loop(){for(var e=Math.min(rep_loading_progress+20,rep_hits.length),t=rep_loading_progress;t<e;++t){var s=get_sang_count(rep_hits[t],selected_member),r='<div class="rep_song_container'+(rep_selected.includes(rep_hits[t])?" selected":"")+(s[0]>0&&s[0]===s[1]?" rep_mem_only":"")+'" id="rep_song_'+rep_hits[t]+'"><div class="rep_song_row1">';r+='<div class="rep_song_title">'+song[rep_hits[t]][song_idx.name]+" / "+song[rep_hits[t]][song_idx.artist]+"</div>",r+='<div class="rep_song_nooke">'+(oke_gone.includes(song[rep_hits[t]][song_idx.name])?"オケ消滅":"")+"</div>",r+='</div><div class="rep_song_info grid_block-4">';var n=get_last_sang(rep_hits[t],selected_member),o=0===n?-1:get_date_different(n);r+="<div>"+(0===o?"今日":-1===o?"---":o+"日前")+"</div>",r+="<div>"+s[0]+"回"+(s[1]>0?s[0]===s[1]?" (メン限のみ)":" ("+s[1]+"回メン限)":"")+"</div>",r+='<div class="rep_song_singer'+(key_valid?" rep_singer_2rows":"")+'"><div class="'+(rep_hits_solo[rep_hits[t]].includes(4)?"rep_song_kirara":"rep_song_empty")+'"></div><div class="'+(rep_hits_solo[rep_hits[t]].includes(2)?"rep_song_momo":"rep_song_empty")+'"></div><div class="'+(rep_hits_solo[rep_hits[t]].includes(1)?"rep_song_nia":"rep_song_empty")+'"></div>'+(key_valid?'<div class="'+(rep_hits_solo[rep_hits[t]].includes(32)?"rep_song_chui":"rep_song_empty")+'"></div><div class="'+(rep_hits_solo[rep_hits[t]].includes(16)?"rep_song_shiro":"rep_song_empty")+'"></div><div class="'+(rep_hits_solo[rep_hits[t]].includes(8)?"rep_song_yuco":"rep_song_empty")+'"></div>':"")+"</div>",r+=do_show_release?'<div class="rep_extra_info"> ('+display_date(to8601(song[rep_hits[t]][song_idx.release]))+")</div>":"<div></div>",$("#rep_display").append(r+"</div></div>")}(rep_loading_progress+=20)>=rep_hits.length&&(clearInterval(rep_display_inter),$("#rep_display").append('<div class="general_vertical_space"></div>'))}function rep_update_list(){for(var e="",t=0;t<rep_selected.length;++t)e+='<div id="rep_btn_'+t+'" class="rep_list_item"></div>';$("#rep_list_leftbar").html(e),e="";var s=$("#list_artist_cb").hasClass("selected"),r=0;for(t=0;t<rep_selected.length;++t){var n=song[rep_selected[t]][song_idx.name]+(s?" / "+song[rep_selected[t]][song_idx.artist]:"");for(var o in e+='<div id="list_'+t+'">'+n+"</div>",n)r+=/[ -~]/.test(n[o])?1:2;r++}$("#rep_list_content").html(e),$(".rep_list_wordcount").html("長さ<br />"+r+"/280"),$(".rep_list_wordcount").toggleClass("red_text",r>280)}function rep_update_leftbar(){$(".rep_list_item").attr("class","rep_list_item"),$(".rep_list_delete").addClass("hidden"),rep_edit_selected>=0&&($(".rep_list_item").addClass("blank"),rep_edit_selected>0&&$("#rep_btn_"+(rep_edit_selected-1)).attr("class","rep_list_item arrow_up"),$("#rep_btn_"+rep_edit_selected).attr("class","rep_list_item"),rep_edit_selected<rep_hits.length-1&&$("#rep_btn_"+(rep_edit_selected+1)).attr("class","rep_list_item arrow_down"),$(".rep_list_delete").removeClass("hidden"))}function update_rep_sort_display(){var e="";switch(rep_sort){case"50":e=rep_sort_asd?"正順 (⇌逆順)":"逆順 (⇌正順)";break;case"count":e=rep_sort_asd?"多い順 (⇌少ない順)":"少ない順 (⇌多い順)";break;case"date":case"release":e=rep_sort_asd?"新しい順 (⇌古い順)":"古い順 (⇌新しい順)";break;default:return 1}$("#sort_name_sort").html(e)}